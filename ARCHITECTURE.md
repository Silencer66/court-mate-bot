# Архитектура CourtMate Bot

## Обзор

Бот использует модульную архитектуру для лучшей масштабируемости и поддержки кода.

## Структура проекта

```
src/
├── handlers/           # Обработчики команд и действий
│   ├── startHandler.ts     # Обработка команды /start
│   ├── surveyHandler.ts    # Управление опросом пользователя
│   └── commandHandler.ts   # Обработка команд (help, profile, ping)
├── routes/             # Маршруты бота
│   └── botRoutes.ts        # Основная настройка маршрутов
├── services/           # Бизнес-логика
│   ├── playerService.ts    # Управление игроками
│   └── surveyService.ts    # Логика опроса
├── config/             # Конфигурация
│   └── database.ts         # Настройка базы данных
├── constants/          # Константы
│   └── EnvVars.ts          # Переменные окружения
├── types/              # Типы TypeScript
│   └── tennis.ts           # Типы для теннисного приложения
└── index.ts            # Главный файл приложения
```

## Принципы архитектуры

### 1. Разделение ответственности

-   **Handlers** - обработка пользовательского ввода
-   **Services** - бизнес-логика
-   **Routes** - регистрация обработчиков
-   **Types** - типизация данных

### 2. Инверсия зависимостей

-   Handlers получают Services через конструктор
-   Routes создают и связывают все компоненты

### 3. Единая точка входа

-   `index.ts` только инициализирует бота и настраивает маршруты
-   Вся логика вынесена в отдельные модули

## Преимущества новой архитектуры

1. **Масштабируемость** - легко добавлять новые команды и функции
2. **Читаемость** - каждый файл отвечает за одну область
3. **Тестируемость** - можно тестировать каждый компонент отдельно
4. **Поддержка** - проще находить и исправлять ошибки
5. **Переиспользование** - Services можно использовать в разных Handlers

## Добавление новых функций

### Новая команда

1. Создать метод в `CommandHandler` или новый Handler
2. Зарегистрировать в `botRoutes.ts`
3. Добавить в список команд в `handleHelp`

### Новый этап опроса

1. Добавить метод в `SurveyHandler`
2. Зарегистрировать action в `botRoutes.ts`
3. Обновить логику переходов между этапами

### Новый сервис

1. Создать класс в `services/`
2. Внедрить через конструктор в нужные Handlers
3. Зарегистрировать в `botRoutes.ts`

## Примеры использования

```typescript
// Добавление новой команды
export class CommandHandler {
    // ... существующие методы ...

    handleFind(ctx: Context) {
        // Логика поиска соперника
    }
}

// В botRoutes.ts
bot.command("find", (ctx) => commandHandler.handleFind(ctx));
```

Эта архитектура позволяет легко расширять функциональность бота, добавляя новые модули без изменения существующего кода.
