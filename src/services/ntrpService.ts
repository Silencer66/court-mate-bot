import { NTRPQuestion, NTRPLevel } from "../types/tennis";

// NTRP уровни с описанием навыков
export const NTRP_LEVELS: NTRPLevel[] = [
    {
        rating: 1.0,
        description: "Начинающий игрок",
        skills: ["Только начинает играть в теннис"],
    },
    {
        rating: 1.5,
        description: "Игрок с ограниченными навыками",
        skills: ["Ограниченные навыки", "Работает над удержанием мяча в игре"],
    },
    {
        rating: 2.0,
        description: "Нуждается в большем опыте",
        skills: [
            "Заметные недостатки в ударах",
            "Знаком с базовыми позициями в одиночной и парной игре",
        ],
    },
    {
        rating: 2.5,
        description: "Учится предугадывать направление мяча",
        skills: [
            "Слабый контроль корта",
            "Может поддерживать игру в медленном темпе с игроками аналогичного уровня",
        ],
    },
    {
        rating: 3.0,
        description: "Стабильно возвращает мячи в среднем темпе",
        skills: [
            "Стабильно возвращает мячи в среднем темпе",
            "Чувствует неуверенность при контроле направления, глубины и силы",
        ],
    },
    {
        rating: 3.5,
        description: "Хороший контроль направления на умеренно сложных ударах",
        skills: [
            "Хороший контроль направления на умеренно сложных ударах",
            "Недостает контроля глубины и разнообразия",
            "Решительно играет у сетки",
            "Улучшает игру в парном разряде",
        ],
    },
    {
        rating: 4.0,
        description: "Выполняет надежные удары",
        skills: [
            "Выполняет надежные удары",
            "Контролирует направление и глубину форхендом и бэкхендом",
            "Успешно использует свечи, смэши, завершающие удары и воллеи",
            "Может допускать ошибки при подаче",
            "Использует командную тактику в парной игре",
        ],
    },
    {
        rating: 4.5,
        description: "Приобрел навыки использования силы и вращения",
        skills: [
            "Приобрел навыки использования силы и вращения",
            "Контролирует темп игры",
            "Хорошая работа ног",
            "Может контролировать глубину удара",
            "Меняет тактику в зависимости от соперника",
            "Сильная и точная первая подача",
            "Стабильная вторая подача",
            "Может атаковать у сетки",
        ],
    },
    {
        rating: 5.0,
        description: "Хорошее чувство мяча",
        skills: [
            "Хорошее чувство мяча",
            "Часто выполняет специальные удары",
            "Может выигрывать очки или заставлять соперника ошибаться",
            "Успешно использует свечи, укороченные удары, полуволлеи или смэши",
            "Использует хорошую глубину и вращение на второй подаче",
        ],
    },
    {
        rating: 5.5,
        description:
            "Использует мощные удары и стабильность как основное оружие",
        skills: [
            "Использует мощные удары и стабильность как основное оружие",
            "Может менять стратегию и стиль игры в зависимости от ситуации",
            "Выполняет надежные удары в стрессовых ситуациях",
        ],
    },
    {
        rating: 6.0,
        description:
            "Высокий уровень, соответствующий национальным юниорским соревнованиям",
        skills: [
            "Национальный рейтинг",
            "Уровень национальных юниорских соревнований",
        ],
    },
    {
        rating: 6.5,
        description: "Приближается к уровню 7.0",
        skills: ["Опыт в сателлитных турнирах"],
    },
    {
        rating: 7.0,
        description: "Игрок мирового класса",
        skills: [
            "Участвует в международных турнирах",
            "Призовые деньги - основной источник дохода",
        ],
    },
];

// Вопросы для определения NTRP рейтинга
export const NTRP_QUESTIONS: NTRPQuestion[] = [
    {
        id: "serve",
        question: "Как бы вы описали вашу подачу?",
        options: [
            { value: 1.0, text: "Только начинаю учиться подавать" },
            { value: 2.0, text: "Могу подать, но часто ошибаюсь" },
            { value: 3.0, text: "Стабильная подача, но без особой силы" },
            { value: 4.0, text: "Хорошая первая подача, стабильная вторая" },
            { value: 5.0, text: "Сильная и точная подача" },
            { value: 6.0, text: "Профессиональная подача" },
        ],
    },
    {
        id: "forehand",
        question: "Как бы вы оценили ваш форхенд?",
        options: [
            { value: 1.0, text: "Только начинаю учиться" },
            { value: 2.0, text: "Могу отбить мяч, но часто ошибаюсь" },
            { value: 3.0, text: "Стабильный удар в среднем темпе" },
            { value: 4.0, text: "Хороший контроль направления и глубины" },
            { value: 5.0, text: "Мощный и точный удар" },
            { value: 6.0, text: "Профессиональный уровень" },
        ],
    },
    {
        id: "backhand",
        question: "Как бы вы оценили ваш бэкхенд?",
        options: [
            { value: 1.0, text: "Только начинаю учиться" },
            { value: 2.0, text: "Могу отбить мяч, но часто ошибаюсь" },
            { value: 3.0, text: "Стабильный удар в среднем темпе" },
            { value: 4.0, text: "Хороший контроль направления и глубины" },
            { value: 5.0, text: "Мощный и точный удар" },
            { value: 6.0, text: "Профессиональный уровень" },
        ],
    },
    {
        id: "volley",
        question: "Как бы вы оценили вашу игру у сетки?",
        options: [
            { value: 1.0, text: "Не играю у сетки" },
            { value: 2.0, text: "Редко подхожу к сетке" },
            { value: 3.0, text: "Могу сыграть простой воллей" },
            { value: 4.0, text: "Хорошо играю у сетки" },
            { value: 5.0, text: "Отлично атакую у сетки" },
            { value: 6.0, text: "Профессиональная игра у сетки" },
        ],
    },
    {
        id: "strategy",
        question: "Как бы вы оценили ваше понимание тактики?",
        options: [
            { value: 1.0, text: "Не понимаю тактику" },
            { value: 2.0, text: "Знаю базовые позиции" },
            { value: 3.0, text: "Понимаю простую тактику" },
            { value: 4.0, text: "Могу менять тактику в игре" },
            { value: 5.0, text: "Хорошо читаю игру соперника" },
            { value: 6.0, text: "Профессиональное понимание тактики" },
        ],
    },
    {
        id: "experience",
        question: "Какой у вас опыт игры в теннис?",
        options: [
            { value: 1.0, text: "Менее 6 месяцев" },
            { value: 2.0, text: "6 месяцев - 1 год" },
            { value: 3.0, text: "1-2 года" },
            { value: 4.0, text: "2-5 лет" },
            { value: 5.0, text: "5-10 лет" },
            { value: 6.0, text: "Более 10 лет" },
        ],
    },
];

// Функция для определения NTRP рейтинга на основе ответов
export function calculateNTRPRating(answers: Record<string, number>): number {
    const totalScore = Object.values(answers).reduce(
        (sum, score) => sum + score,
        0
    );
    const averageScore = totalScore / Object.keys(answers).length;

    // Находим ближайший NTRP рейтинг
    let closestRating = 1.0;
    let minDifference = Math.abs(averageScore - 1.0);

    for (const level of NTRP_LEVELS) {
        const difference = Math.abs(averageScore - level.rating);
        if (difference < minDifference) {
            minDifference = difference;
            closestRating = level.rating;
        }
    }

    return closestRating;
}

// Функция для валидации NTRP рейтинга
export function validateNTRPRating(rating: number): boolean {
    return rating >= 1.0 && rating <= 7.0 && rating % 0.5 === 0;
}

// Функция для получения описания NTRP уровня
export function getNTRPLevelDescription(rating: number): NTRPLevel | null {
    return NTRP_LEVELS.find((level) => level.rating === rating) || null;
}
